{% extends "oids/base.html" %}
{% load static %}

{% block title %}Головна панель ОІД{% endblock %}

{% block content %}
<div class="header">
    <h1>Панель керування Об'єктами Інформаційної Діяльності</h1>
</div>

<div class="dashboard-columns" style="display: flex; gap: 20px;">
    {# Стовпчик 1: Військові частини #}
    <div class="column" style="flex: 1; border: 1px solid #ccc; padding: 10px;">
        <h3>Військові частини</h3>
        <form method="get" action="{% url 'main_dashboard' %}" id="unitFilterFormMain">
            <select name="unit" id="id_unit" class="select2" style="width: 100%;" onchange="this.form.submit();">
                <option value="">--------- Всі ВЧ ---------</option>
                {% for unit_obj in all_units %}
                    <option value="{{ unit_obj.id }}" {% if unit_obj.id == selected_unit_id %}selected{% endif %}>
                        {{ unit_obj.code }} - {{ unit_obj.name|default:unit_obj.city }} 
                        ({{ unit_obj.territorial_management.name|default:"ТУ не вказано" }})
                    </option>
                {% endfor %}
            </select>
        </form>
    </div>

    {# Стовпчик 2: ОІД #}
    <div class="column" style="flex: 2; border: 1px solid #ccc; padding: 10px;">
        <h3>
            Об'єкти інформаційної діяльності 
            {% if selected_unit_object %}
                (для ВЧ: {{ selected_unit_object.code }} - {{ selected_unit_object.name|default:selected_unit_object.city }})
            {% else %}
                (Оберіть ВЧ для відображення ОІД)
            {% endif %}
        </h3>

        {% if selected_unit_id %}
            <div class="oid-list-section">
                <h4>ОІД, що створюються</h4>
                <ul>
                    {% for oid in oids_creating %}
                        <li>
                            <a href="{% url 'oid_detail_view_name' oid.id %}">{{ oid.cipher }} - {{ oid.full_name|default_if_none:oid.unit.city }} ({{ oid.get_oid_type_display }})</a>
                            <span>({{ oid.get_status_display }})</span>
                        </li>
                    {% empty %}
                        <li>Немає.</li>
                    {% endfor %}
                </ul>
            </div>
            <hr>
            <div class="oid-list-section">
                <h4>Діючі ОІД</h4>
                <ul>
                    {% for oid in oids_active %}
                        <li class="oid-item">
                            <a href="{% url 'oid_detail_view_name' oid.id %}">{{ oid.cipher }} - {{ oid.full_name|default_if_none:oid.unit.city }} ({{ oid.get_oid_type_display }})</a>
                            <div class="expirations" style="font-size: 0.8em; color: grey;">
                                {% if oid.ik_expiration_date %}ІК до: {{ oid.ik_expiration_date|date:"d.m.Y" }}{% endif %}
                                {% if oid.attestation_expiration_date %} / Атестація до: {{ oid.attestation_expiration_date|date:"d.m.Y" }}{% endif %}
                                {% if oid.prescription_expiration_date %} / Припис до: {{ oid.prescription_expiration_date|date:"d.m.Y" }}{% endif %}
                            </div>
                        </li>
                    {% empty %}
                        <li>Немає.</li>
                    {% endfor %}
                </ul>
            </div>
            <hr>
            <div class="oid-list-section">
                <h4>Скасовані/Припинені ОІД</h4>
                <ul>
                    {% for oid in oids_cancelled %}
                        <li>
                            <a href="{% url 'oid_detail_view_name' oid.id %}">{{ oid.cipher }} - {{ oid.full_name|default_if_none:oid.unit.city }} ({{ oid.get_oid_type_display }})</a>
                            <span>({{ oid.get_status_display }})</span>
                        </li>
                    {% empty %}
                        <li>Немає.</li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}