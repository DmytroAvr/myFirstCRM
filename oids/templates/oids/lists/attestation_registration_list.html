{% extends "oids/base.html" %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <h2 class="mb-4">{{ page_title }}</h2>
    {# <a href="URL_ДЛЯ_ДОДАВАННЯ_РЕЄСТРАЦІЇ" class="btn btn-primary mb-3">Додати нову Реєстрацію</a> #}

    {% if object_list %}
        <table class="table table-striped table-bordered table-hover">
            <thead class="thead-dark">
                <tr>
                    <th>Дата відправки на реєстрацію</th>
                    <th>Реєстр. номер листа до ДССЗЗІ</th>
                    <th>Військові частини</th>
                    <th>ОІДи та Акти атестації</th>
                    <th>Файл (скан листа)</th>
                    <th>Примітки</th>
                    <th>Відповідь ДССЗЗІ</th>
                    {# <th>Дії</th> #}
                </tr>
            </thead>
            <tbody>
                {% for reg in object_list %}
                    <tr>
                        <td>{{ reg.process_date|date:"d.m.Y" }}</td>
                        <td>{{ reg.registration_number|default:"-" }}</td>
                        <td>
                            <ul>
                            {% for unit in reg.units.all %}
                                <li>{{ unit.code }} - {{ unit.name|default:unit.city }}</li>
                            {% empty %}
                                <li>-</li>
                            {% endfor %}
                            </ul>
                        </td>
                        <td>
                            <ul>
                            {% for item in reg.attestation_items.all %}
                                <li>
                                    ОІД: <a href="{% url 'oids:oid_detail_view_name' item.oid.id %}">{{ item.oid.cipher }}</a> (ВЧ: {{ item.oid.unit.code }})
                                    <br>
                                    Акт: {{ item.document.document_type.name }} №{{ item.document.document_number }}
                                </li>
                            {% empty %}
                                <li>Немає актів</li>
                            {% endfor %}
                            </ul>
                        </td>
                        <td>
                            {% if reg.attachment %}
                                <a href="{{ reg.attachment.url }}" target="_blank">Переглянути</a>
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>{{ reg.note|truncatewords:10|default:"-" }}</td>
                        <td>
                            {% if reg.response %}
                                Зареєстровано №{{ reg.response.registered_number }} від {{ reg.response.registered_date|date:"d.m.Y" }}
                            {% else %}
                                Очікується
                            {% endif %}
                        </td>
                        {# <td>
                            <a href="#" class="btn btn-sm btn-info">Деталі</a>
                            <a href="#" class="btn btn-sm btn-warning">Редагувати</a>
                        </td> #}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        {% include "../includes/pagination.html" %}
    {% else %}
        <p>Записи про реєстрацію актів атестації не знайдено.</p>
    {% endif %}
</div>
{% endblock %}