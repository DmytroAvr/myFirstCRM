<!-- C:\myFirstCRM\oids\templates\oids\document_done.html -->

<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–î–æ–¥–∞—Ç–∏ –æ–ø—Ä–∞—Ü—å–æ–≤–∞–Ω—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏</title>
  <style>
    :root {
      --bg-light: #ffffff;
      --bg-dark: #1a1a1a;
      --text-light: #1a1a1a;
      --text-dark: #f0f0f0;
      --input-bg-light: #f9f9f9;
      --input-bg-dark: #2c2c2c;
      --border-light: #cccccc;
      --border-dark: #444444;
      --btn-bg-light: #f0f0f0;
      --btn-bg-dark: #444;
      --btn-text-light: #000;
      --btn-text-dark: #fff;
    }

    body {
      margin: 20px;
      font-family: sans-serif;
      background-color: var(--bg-light);
      color: var(--text-light);
      transition: background-color 0.3s, color 0.3s;
    }

    .dark-theme {
      background-color: var(--bg-dark);
      color: var(--text-dark);
    }

    .theme-toggle {
      position: fixed;
      top: 10px;
      right: 10px;
      background-color: transparent;
      color: inherit;
      border: 1px solid currentColor;
      padding: 5px 10px;
      cursor: pointer;
      font-size: 0.9rem;
      border-radius: 5px;
    }

    h2, h3 {
      margin-top: 1.5rem;
      margin-bottom: 0.5rem;
    }

    form {
      max-width: 900px;
      margin: auto;
    }

    p {
      margin-bottom: 1rem;
    }

    label {
      display: block;
      margin-bottom: 4px;
    }

    input, select, textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid var(--border-light);
      background-color: var(--input-bg-light);
      color: var(--text-light);
      transition: background-color 0.3s, color 0.3s, border-color 0.3s;
    }
    textarea {
      height: 20px;
    }

    .dark-theme input,
    .dark-theme select,
    .dark-theme textarea {
      background-color: var(--input-bg-dark);
      color: var(--text-dark);
      border: 1px solid var(--border-dark);
    }

    .document-form {
      border: 1px solid var(--border-light);
      padding: 15px;
      margin: 15px 0;
      border-radius: 5px;
      background-color: var(--input-bg-light);
      transition: background-color 0.3s, border-color 0.3s;
    }

    .dark-theme .document-form {
      background-color: var(--input-bg-dark);
      border: 1px solid var(--border-dark);
    }

    button {
      padding: 8px 14px;
      margin-top: 10px;
      font-size: 0.95rem;
      border: none;
      cursor: pointer;
      border-radius: 5px;
      background-color: var(--btn-bg-light);
      color: var(--btn-text-light);
      border: 1px solid var(--border-light);
      transition: background-color 0.3s, color 0.3s;
    }

    .dark-theme button {
      background-color: var(--btn-bg-dark);
      color: var(--btn-text-dark);
      border: 1px solid var(--border-dark);
    }

    .remove-form {
      background-color: #e74c3c;
      color: white;
      margin-top: 10px;
    }

    .dark-theme .remove-form {
      background-color: #c0392b;
    }

    input[type="checkbox"][name$="-DELETE"] {
        display: none;
    }
    label[for$="-DELETE"] {
        display: none;
    }
  </style>
</head>
<body>

<button class="theme-toggle" onclick="toggleTheme()">–ó–º—ñ–Ω–∏—Ç–∏ —Ç–µ–º—É</button>

        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-success">{{ message }}</div>
            {% endfor %}
        {% endif %}

    <form method="post">
        {% csrf_token %}

        <h2>–î–æ–¥–∞—Ç–∏ –æ–ø—Ä–∞—Ü—å–æ–≤–∞–Ω—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏ –ø–æ –û–Ü–î</h2>

        <h3>–∑–∞–≥–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è:</h3>
        {{ header_form.as_p }}
<br>
        <h3>–î–æ–∫—É–º–µ–Ω—Ç–∏:</h3>
        <div id="formset">
            {{ formset.management_form }}
            {% for form in formset %}
                <div class="document-form" style="border: 1px solid #ccc; margin: 10px; padding: 10px; position: relative;">
                    {{ form.as_p }}
                    <button type="button" class="remove-form">üóë –í–∏–¥–∞–ª–∏—Ç–∏</button>
                </div>
            {% endfor %}
        </div>

        <button type="button" id="add-form">‚ûï –î–æ–¥–∞—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç</button>
        <br><br>
        <button type="submit">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –≤—Å—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏</button>
    </form>

</body>

<script>
    document.querySelector('#id_unit').addEventListener('change', function () {
        const unitId = this.value;
        const oidSelect = document.querySelector('#id_oid');
        fetch(`/oids/ajax/load-oids/?unit=${unitId}`)
            .then(response => response.json())
            .then(data => {
                oidSelect.innerHTML = '';
                data.forEach(oid => {
                    const option = new Option(oid.name, oid.id);
                    oidSelect.add(option);
                });
            });
    });

    // button to add new form
    document.addEventListener('DOMContentLoaded', function () {
        const formset = document.getElementById('formset');
        const addFormBtn = document.getElementById('add-form');
        const totalForms = document.querySelector('#id_form-TOTAL_FORMS');

        function updateDeleteButtons() {
            document.querySelectorAll('.remove-form').forEach(btn => {
                btn.removeEventListener('click', removeForm);
                btn.addEventListener('click', removeForm);
            });
        }

        function removeForm(event) {
            const formDiv = event.target.closest('.document-form');
            formDiv.remove();
            // –û–Ω–æ–≤–∏—Ç–∏ –ª—ñ—á–∏–ª—å–Ω–∏–∫ —Ñ–æ—Ä–º
            const forms = document.querySelectorAll('.document-form');
            totalForms.value = forms.length;

            // –ü–µ—Ä–µ–Ω—É–º–µ—Ä–∞—Ü—ñ—è —ñ–Ω–ø—É—Ç—ñ–≤
            forms.forEach((form, index) => {
                form.querySelectorAll('input, select, textarea, label').forEach(el => {
                    if (el.name) el.name = el.name.replace(/form-\d+-/, `form-${index}-`);
                    if (el.id) el.id = el.id.replace(/form-\d+-/, `form-${index}-`);
                    if (el.htmlFor) el.htmlFor = el.htmlFor.replace(/form-\d+-/, `form-${index}-`);
                });
            });
        }

        addFormBtn.addEventListener('click', function () {
            const forms = document.querySelectorAll('.document-form');
            const newForm = forms[0].cloneNode(true);
            const newIndex = forms.length;

            // –û—á–∏—Å—Ç–∏—Ç–∏ –ø–æ–ª—è
            newForm.querySelectorAll('input, select, textarea').forEach(el => {
                if (el.type !== 'hidden') el.value = '';
            });

            // –ó–º—ñ–Ω–∏—Ç–∏ name/id –Ω–∞ –Ω–æ–≤–∏–π —ñ–Ω–¥–µ–∫—Å
            newForm.querySelectorAll('input, select, textarea, label').forEach(el => {
                if (el.name) el.name = el.name.replace(/form-\d+-/, `form-${newIndex}-`);
                if (el.id) el.id = el.id.replace(/form-\d+-/, `form-${newIndex}-`);
                if (el.htmlFor) el.htmlFor = el.htmlFor.replace(/form-\d+-/, `form-${newIndex}-`);
            });

            formset.appendChild(newForm);
            totalForms.value = newIndex + 1;
            updateDeleteButtons();
        });

        updateDeleteButtons();
    });
    
</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll("form").forEach(form => {
            form.setAttribute("autocomplete", "off");
        });
    });

    function toggleTheme() {
    document.body.classList.toggle('dark-theme');
    }
</script>
