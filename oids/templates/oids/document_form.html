<!-- C:\myFirstCRM\oids\templates\oids\document_form.html -->
<form method="post">
    {% csrf_token %}

    <h3>Основна інформація</h3>
    {{ header_form.as_p }}

    <h3>Документи</h3>
    {{ formset.management_form }}
    {% for form in formset %}
        <div style="border: 1px solid #ccc; margin: 10px; padding: 10px;">
            {{ form.as_p }}
        </div>
    {% endfor %}

    <button type="submit">Зберегти всі документи</button>
</form>

<script>
    document.querySelector('#id_unit').addEventListener('change', function () {
        const unitId = this.value;
        const oidSelect = document.querySelector('#id_oid');
        fetch(`/oids/ajax/load-oids/?unit=${unitId}`)
            .then(response => response.json())
            .then(data => {
                oidSelect.innerHTML = '';
                data.forEach(oid => {
                    const option = new Option(oid.name, oid.id);
                    oidSelect.add(option);
                });
            });
    });
</script>
