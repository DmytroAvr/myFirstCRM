{% extends 'base.html' %}
{% load static %}

{% block title %}{{ project.name }} - –î–µ—Ç–∞–ª—ñ - TaskFlow{% endblock %}

{% block extra_css %}
<style>
</style>
{% endblock %}

{% block content %}
<div class="container-fluid px-4 py-4">
    <!-- –ù–∞–≤—ñ–≥–∞—Ü—ñ—è -->
    <nav aria-label="breadcrumb" class="mb-3">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'taskFlow:project_list' %}">–ü—Ä–æ—î–∫—Ç–∏</a></li>
            <li class="breadcrumb-item active">{{ project.name }}</li>
        </ol>
    </nav>

    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–æ—î–∫—Ç—É -->
    <div class="project-header">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <div class="mb-2">
                    <code class="badge bg-white text-dark fs-6">{{ project.key }}</code>
                    <span class="badge bg-light text-dark ms-2">{{ project.get_group_display }}</span>
                </div>
                <h1 class="display-5 mb-3">{{ project.name }}</h1>
                {% if project.description %}
                <p class="lead mb-0 opacity-90">{{ project.description }}</p>
                {% endif %}
            </div>
            <div class="col-lg-4 text-lg-end mt-3 mt-lg-0">
                <div class="d-flex flex-column gap-2">
                    <a href="{% url 'taskFlow:project_board' project.pk %}" class="btn btn-light btn-lg">
                        <i class="bi bi-kanban"></i> –ö–∞–Ω–±–∞–Ω-–¥–æ—à–∫–∞
                    </a>
                    <a href="{% url 'taskFlow:task_create' %}?project={{ project.pk }}" class="btn btn-outline-light">
                        <i class="bi bi-plus-lg"></i> –°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="stat-card">
                <div class="stat-value text-primary">{{ statistics.total_tasks }}</div>
                <div class="stat-label">–í—Å—å–æ–≥–æ –∑–∞–≤–¥–∞–Ω—å</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card">
                <div class="stat-value text-warning">{{ statistics.active }}</div>
                <div class="stat-label">–ê–∫—Ç–∏–≤–Ω–∏—Ö</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card">
                <div class="stat-value text-success">{{ statistics.completed }}</div>
                <div class="stat-label">–í–∏–∫–æ–Ω–∞–Ω–æ</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card">
                <div class="stat-value text-danger">{{ statistics.overdue }}</div>
                <div class="stat-label">–ü—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–æ</div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- –õ—ñ–≤–∞ –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="col-lg-8">
            <!-- –ü—Ä–æ–≥—Ä–µ—Å –ø–æ —Å—Ç–∞—Ç—É—Å–∞—Ö -->
            <div class="chart-card">
                <h5 class="mb-4">üìä –†–æ–∑–ø–æ–¥—ñ–ª –∑–∞ —Å—Ç–∞—Ç—É—Å–∞–º–∏</h5>
                {% for item in statistics.by_status %}
                <div class="progress-item">
                    <div class="progress-label">
                        <span class="flex-grow-1">{{ item.status__name }}</span>
                        <span class="fw-semibold">{{ item.count }} ({% widthratio item.count statistics.total_tasks 100 %}%)</span>
                    </div>
                    <div class="progress-bar-custom">
                        <div class="progress-fill bg-primary" 
                             style="width: {% widthratio item.count statistics.total_tasks 100 %}%"></div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–∏ -->
            <div class="chart-card">
                <h5 class="mb-4">‚ö° –†–æ–∑–ø–æ–¥—ñ–ª –∑–∞ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–∞–º–∏</h5>
                <div class="row g-3">
                    {% for item in statistics.by_priority %}
                    <div class="col-6">
                        <div class="d-flex justify-content-between align-items-center p-3 border rounded">
                            <div>
                                <div class="fw-semibold">
                                    {% if item.priority == 'low' %}üü¢ –ù–∏–∑—å–∫–∏–π
                                    {% elif item.priority == 'medium' %}üü° –°–µ—Ä–µ–¥–Ω—ñ–π
                                    {% elif item.priority == 'high' %}üü† –í–∏—Å–æ–∫–∏–π
                                    {% elif item.priority == 'critical' %}üî¥ –ö—Ä–∏—Ç–∏—á–Ω–∏–π
                                    {% endif %}
                                </div>
                                <small class="text-muted">{{ item.count }} –∑–∞–≤–¥–∞–Ω—å</small>
                            </div>
                            <div class="fs-4 fw-bold text-primary">{{ item.count }}</div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ -->
            <div class="chart-card">
                <h5 class="mb-4">üìà –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ—î–∫—Ç—É</h5>
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="p-3 bg-light rounded">
                            <div class="text-muted small mb-1">–í—ñ–¥—Å–æ—Ç–æ–∫ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è</div>
                            <div class="fs-3 fw-bold text-success">{{ statistics.completion_rate }}%</div>
                        </div>
                    </div>
                    {% if statistics.avg_completion_days %}
                    <div class="col-md-6">
                        <div class="p-3 bg-light rounded">
                            <div class="text-muted small mb-1">–°–µ—Ä–µ–¥–Ω—ñ–π —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è</div>
                            <div class="fs-3 fw-bold text-info">{{ statistics.avg_completion_days }} –¥–Ω—ñ–≤</div>
                        </div>
                    </div>
                    {% endif %}
                    <div class="col-md-6">
                        <div class="p-3 bg-light rounded">
                            <div class="text-muted small mb-1">–ó–∞–≤–¥–∞–Ω—å –Ω–∞ —Ü–µ–π —Ç–∏–∂–¥–µ–Ω—å</div>
                            <div class="fs-3 fw-bold text-warning">{{ statistics.due_this_week }}</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="p-3 bg-light rounded">
                            <div class="text-muted small mb-1">–ü—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è</div>
                            <div class="fs-3 fw-bold text-danger">{{ statistics.overdue }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞ –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="col-lg-4">
            <!-- –¢–æ–ø –≤–∏–∫–æ–Ω–∞–≤—Ü—ñ–≤ -->
            <div class="chart-card">
                <h5 class="mb-4">üë• –¢–æ–ø –≤–∏–∫–æ–Ω–∞–≤—Ü—ñ–≤</h5>
                {% if statistics.by_assignee %}
                    {% for item in statistics.by_assignee %}
                    <div class="team-member">
                        <div class="member-avatar">
                            {{ item.assignee__full_name|slice:":1"|upper }}
                        </div>
                        <div class="flex-grow-1">
                            <div class="fw-semibold">{{ item.assignee__full_name }}</div>
                            <small class="text-muted">{{ item.count }} –∞–∫—Ç–∏–≤–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å</small>
                        </div>
                        <div class="badge bg-primary">{{ item.count }}</div>
                    </div>
                    {% endfor %}
                {% else %}
                    <p class="text-muted text-center py-3">
                        <i class="bi bi-people" style="font-size: 2rem;"></i><br>
                        –ù–µ–º–∞—î –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å
                    </p>
                {% endif %}
            </div>

            <!-- –®–≤–∏–¥–∫—ñ –¥—ñ—ó -->
            <div class="chart-card">
                <h5 class="mb-4">‚ö° –®–≤–∏–¥–∫—ñ –¥—ñ—ó</h5>
                <div class="d-grid gap-2">
                    <a href="{% url 'taskFlow:project_board' project.pk %}" class="btn btn-primary">
                        <i class="bi bi-kanban"></i> –í—ñ–¥–∫—Ä–∏—Ç–∏ –¥–æ—à–∫—É
                    </a>
                    <a href="{% url 'taskFlow:task_list' %}?project={{ project.pk }}" class="btn btn-outline-secondary">
                        <i class="bi bi-list-ul"></i> –°–ø–∏—Å–æ–∫ –∑–∞–≤–¥–∞–Ω—å
                    </a>
                    <a href="{% url 'taskFlow:task_create' %}?project={{ project.pk }}" class="btn btn-outline-success">
                        <i class="bi bi-plus-lg"></i> –ù–æ–≤–µ –∑–∞–≤–¥–∞–Ω–Ω—è
                    </a>
                    <a href="/admin/taskFlow/project/{{ project.pk }}/change/" class="btn btn-outline-info">
                        <i class="bi bi-gear"></i> –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
                    </a>
                </div>
            </div>

            <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ø—Ä–æ—î–∫—Ç -->
            <div class="chart-card">
                <h5 class="mb-4">‚ÑπÔ∏è –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h5>
                <div class="small">
                    <div class="mb-3">
                        <div class="text-muted mb-1">–ö–ª—é—á –ø—Ä–æ—î–∫—Ç—É</div>
                        <code class="bg-light px-2 py-1 rounded">{{ project.key }}</code>
                    </div>
                    <div class="mb-3">
                        <div class="text-muted mb-1">–ü—ñ–¥—Ä–æ–∑–¥—ñ–ª</div>
                        <span class="badge bg-primary">{{ project.get_group_display }}</span>
                    </div>
                    <div class="mb-3">
                        <div class="text-muted mb-1">–í–ª–∞—Å–Ω—ñ —Å—Ç–∞—Ç—É—Å–∏</div>
                        {% if project.use_custom_statuses %}
                            <span class="badge bg-success">–¢–∞–∫</span>
                        {% else %}
                            <span class="badge bg-secondary">–ù—ñ</span>
                        {% endif %}
                    </div>
                    <div class="mb-3">
                        <div class="text-muted mb-1">–°—Ç–≤–æ—Ä–µ–Ω–æ</div>
                        <div>{{ project.created_at|date:"d.m.Y H:i" }}</div>
                    </div>
                    <div>
                        <div class="text-muted mb-1">–û–Ω–æ–≤–ª–µ–Ω–æ</div>
                        <div>{{ project.updated_at|date:"d.m.Y H:i" }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // –ê–Ω—ñ–º–∞—Ü—ñ—è –ø—Ä–æ–≥—Ä–µ—Å-–±–∞—Ä—ñ–≤
    document.addEventListener('DOMContentLoaded', function() {
        const progressFills = document.querySelectorAll('.progress-fill');
        
        progressFills.forEach(fill => {
            const width = fill.style.width;
            fill.style.width = '0';
            
            setTimeout(() => {
                fill.style.width = width;
            }, 100);
        });
    });
</script>
{% endblock %}