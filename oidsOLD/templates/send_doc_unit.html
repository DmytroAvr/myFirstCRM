<!-- C:\myFirstCRM\oids\templates\send_doc_unit.html -->
{% extends 'base.html' %}
{% block title %}Результати роботи у відрядженні (відправка в частину){% endblock %}

{% load static %}
{% block extra_css %}{% endblock %}

{% block content %} 

<h2>Відправка результатів в частину</h2>

<form method="post" enctype="multipart/form-data" id="trip-result-form">
  {% csrf_token %}

  <fieldset>
    <legend>Військові частини</legend>
    <select id="id_units" name="units" class="select2" multiple>
      {% for unit in form.fields.units.queryset %}
        <option value="{{ unit.id }}">{{ unit.code }} - {{ unit.city }}</option>
      {% endfor %}
    </select>
  </fieldset>

  <fieldset>
    <legend>ОІД</legend>
    <select id="id_oids" name="oids" class="select2" multiple>
      <!-- буде довантажено через AJAX -->
    </select>
  </fieldset>

  <fieldset>
    <legend>Заявки</legend>
    <select id="id_related_request" name="related_request" class="select2">
      <!-- буде довантажено через AJAX -->
    </select>
  </fieldset>

  <fieldset>
    <legend>Документи</legend>
    <select id="id_documents" name="documents" class="select2" multiple>
      {% for doc in form.fields.documents.queryset %}
        <option value="{{ doc.id }}">{{ doc.document_type.name }} / {{ doc.document_number }}</option>
      {% endfor %}
    </select>
  </fieldset>

  <fieldset>
    <legend>Дата та файл</legend>
    {{ form.process_date.label_tag }} {{ form.process_date }}<br>
    {{ form.attachment.label_tag }} {{ form.attachment }}
  </fieldset>

  <fieldset>
    <legend>Примітка</legend>
    {{ form.note.label_tag }} {{ form.note }}
  </fieldset>

  <fieldset>
    <legend>Пов'язане відрядження (opційно)</legend>
    {{ form.trip.label_tag }} {{ form.trip }}
  </fieldset>

  <button type="submit">Відправити</button>
</form>
<!-- 
<script>
  // Після завантаження сторінки викликаємо налаштування
  $(document).ready(function () {
    attachOidAside(); // якщо є

    setupDynamicFilter({
      sourceSelectId: '#id_units',
      targetSelectId: '#id_oids',
      url: '/oids/ajax/get-oids-by-units/',
      paramName: 'units[]',
      placeholder: { default: 'Оберіть ОІД', loading: 'Завантаження ОІД...' }
    });

    setupDynamicFilter({
      sourceSelectId: '#id_oids',
      targetSelectId: '#id_related_request',
      url: '/oids/ajax/get-requests-by-oids/',
      paramName: 'oid_ids',
      placeholder: { default: 'Оберіть заявку', loading: 'Завантаження заявок...' },
      transformItem: item => ({ value: item.id, label: `${item.incoming_number} — ${item.incoming_date}` })
    });

    setupDynamicFilter({
      sourceSelectId: '#id_oids',
      targetSelectId: '#id_documents',
      url: '/oids/ajax/load-documents-for-oids/',
      paramName: 'oids[]',
      placeholder: { default: 'Оберіть документи', loading: 'Завантаження документів...' },
      transformItem: item => ({ value: item.id, label: `${item.document_type__name} / ${item.document_number}` })
    });
  });
</script> -->


{% block extra_js %}{% endblock %}
{% endblock %}



   





